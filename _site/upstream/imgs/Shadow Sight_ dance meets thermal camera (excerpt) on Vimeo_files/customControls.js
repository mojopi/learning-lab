define(["infra/logger","utils/graphicUtils","utils/domUtils","css!./IosVideoControls.css"],function(t,e,n){function i(){this.videoControllers=null,this.progressBarContainer=null,this.centralPlayButton=null,this.playButton=null,this.currentTime=null,this.progressBar=null,this.timeBar=null,this.fullScreenButton=null,this.durationTime=null,this.timeDrag=!1,this.element=null,this.containerDiv=null}var r=function(){this.videoControllers=e.buildDiv({classArray:"video-controls"}),this.playButton=e.buildDiv({classArray:"videoButtons play-button"}),n.insertElementIntoContainer(this.videoControllers,this.playButton),this.progressBarContainer=e.buildDiv({classArray:"progressbar-container"}),this.currentTime=e.buildDiv({classArray:"progressbar-text current-time",textContent:"0:00"}),n.insertElementIntoContainer(this.progressBarContainer,this.currentTime),this.progressBar=e.buildDiv({classArray:"progressBar"}),this.timeBar=e.buildDiv({classArray:"timeBar"}),n.insertElementIntoContainer(this.timeBar,e.buildSpan({classArray:"progressBarThumb"})),n.insertElementIntoContainer(this.progressBar,this.timeBar),n.insertElementIntoContainer(this.progressBarContainer,this.progressBar),this.durationTime=e.buildDiv({classArray:"progressbar-text duration-time",textContent:"0:00"}),n.insertElementIntoContainer(this.progressBarContainer,this.durationTime),n.insertElementIntoContainer(this.videoControllers,this.progressBarContainer),this.fullScreenButton=e.buildDiv({classArray:"videoButtons expand-video"}),n.insertElementIntoContainer(this.videoControllers,this.fullScreenButton),this.centralPlayButton=e.buildDiv({classArray:"central-play"}),n.insertElementIntoContainer(this.containerDiv,this.centralPlayButton),n.insertElementIntoContainer(this.containerDiv,this.videoControllers)},s=function(){n.addClass(this.playButton,"pause-button"),n.hideElement(this.videoControllers);var t,e,i=50,r=94,s=175;if(n.getElementWidth(this.element)<=s)n.hideElement(this.progressBarContainer),t=Math.round(n.getElementWidth(this.element)/2-i/2),e=Math.round(n.getElementHeight(this.element)/2-i/2),n.applyStyle(this.centralPlayButton,{width:i+"px",height:i+"px",backgroundPosition:"0px -268px",top:"50%",left:"50%",transform:"translate(-50%, -50%)","-webkit-transform":"translate(-50%, -50%)","-ms-transform":"translate(-50%, -50%)"});else{var l=n.getElementWidth(this.element)-(2*(n.getElementWidth(this.playButton)+parseInt(n.getCssProperty(this.playButton,"margin-left"))+parseInt(n.getCssProperty(this.playButton,"margin-right")))+3);n.applyStyle(this.progressBarContainer,{width:l+"px"}),l-=2*(parseInt(n.getCssProperty(this.progressBar,"margin-left"))+n.getElementWidth(this.currentTime))+12,n.applyStyle(this.progressBar,{width:l+"px"}),t=Math.round(n.getElementWidth(this.element)/2-r/2),e=Math.round(n.getElementHeight(this.element)/2-r/2),n.applyStyle(this.centralPlayButton,{width:r+"px",height:r+"px",backgroundPosition:"0px -104px",top:"50%",left:"50%",transform:"translate(-50%, -50%)","-webkit-transform":"translate(-50%, -50%)","-ms-transform":"translate(-50%, -50%)"})}n.getElementWidth(this.element)<n.getElementHeight(this.element)&&n.applyStyle(this.videoControllers,{bottom:n.getElementHeight(this.element)-n.getElementWidth(this.element)+"px"})},l=function(t){var e=this.element.duration,i=t-n.getOffsetSum(this.progressBar).left,r=100*i/n.getElementWidth(this.progressBar);r>100&&(r=100),0>r&&(r=0),n.applyStyle(this.timeBar,{width:r+"%"}),this.element.currentTime=e*r/100},o=function(){var t=this;n.bindEvent(this.progressBar,"mousedown",function(e){t.timeDrag=!0,l.call(t,e.pageX)}),n.bindEvent(this.progressBar,"mouseup",function(e){t.timeDrag&&(t.timeDrag=!1,l.call(t,e.pageX))}),n.bindEvent(this.progressBar,"mousemove",function(e){t.timeDrag&&l.call(t,e.pageX)}),n.bindEvent(this.playButton,"click",function(e){1==t.element.paused?(t.element.play(),n.setClass(t.playButton,"videoButtons pause-button")):(t.element.pause(),n.setClass(t.playButton,"videoButtons play-button"))}),n.bindEvent(this.centralPlayButton,"click",function(){n.hideElement(t.centralPlayButton),t.element.play(),n.setClass(t.playButton,"videoButtons pause-button"),t.containerDiv.click()}),n.bindEvent(this.fullScreenButton,"click",function(){t.element.requestFullscreen?t.element.requestFullscreen():t.element.mozRequestFullScreen?t.element.mozRequestFullScreen():t.element.webkitRequestFullscreen?t.element.webkitRequestFullscreen():t.element.webkitEnterFullscreen()}),n.bindEvent(this.element,"click",function(){n.isVisible(t.centralPlayButton)||(n.showElement(t.videoControllers),setTimeout(function(){n.hideElement(t.videoControllers)},5e3))}),n.bindEvent(this.element,"timeupdate",function(){var e=t.element.currentTime,i=t.element.duration,r=100*e/i;n.applyStyle(t.timeBar,{width:r+"%"});var s=Math.floor(t.element.currentTime/60),l=Math.floor(t.element.currentTime-60*s),o=Math.floor(t.element.duration/60),a=Math.floor(t.element.duration-60*o);10>l&&(l="0"+l),10>a&&(a="0"+a),n.setElementTextContent(t.currentTime,s+":"+l),n.setElementTextContent(t.durationTime,o+":"+a),t.element.duration==t.element.currentTime&&n.setClass(t.playButton,"videoButtons play-button")}),n.bindEvent(this.containerDiv,"play",function(){1!=t.element.paused&&n.hideElement(t.centralPlayButton)})};return i.prototype.createControls=function(t,e){this.containerDiv=t,this.element=e,r.call(this),s.call(this),o.call(this)},i});