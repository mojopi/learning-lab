define(["comp/mediaComp","utils/objectUtils","utils/domUtils","./customControls","utils/environmentUtils","utils/graphicUtils","infra/logger"],function(t,i,e,n,l,o,s){function a(i){t.call(this,i),this.visibilityCheckTimer=null,this.ignorePause=!1,this.skipBubbling=!1}var r="play",p="pause",h="ended",c="error";a.prototype=new t,a.prototype.getMediaProperties=function(){var i=t.prototype.getMediaProperties.call(this);return i.sources=this.prop.videoSources,this.prop.poster&&(i.elementProperties.poster=this.prop.poster),"stretch"===this.prop.fitting&&(i.styleProperties.width="100%",i.styleProperties.height="100%"),"fit"===this.prop.fitting&&(i.styleProperties.visibility="hidden"),i},a.prototype.onMetadataLoaded=function(){"fit"===this.prop.fitting&&(o.fitElementInContainer(this.internalContainer,this.element,this.prop.fitting),o.alignElement(this.element,this.prop.alignment),e.applyStyle(this.element,{visibility:"inherit"}))},a.prototype.internalDraw=function(){t.prototype.internalDraw.call(this),this.element&&(this.div.style.overflow="visible",v.call(this),g.call(this),b.call(this),f.call(this)?A.call(this):d.call(this)&&m.call(this))};var u=function(){this.visibilityCheckTimer&&(clearInterval(this.visibilityCheckTimer),this.visibilityCheckTimer=null)},y=function(t,i){var n=this;u.call(this),e.isElementVisible(this.div)!==t||o.getFullScreenElement()?this.visibilityCheckTimer=setInterval(function(){e.isElementVisible(n.div)!==t||o.getFullScreenElement()||(clearInterval(n.visibilityCheckTimer),i.call(n))},100):i.call(n)},m=function(){this.element.controls=!1;var t=new n;t.createControls(this.internalContainer,this.element)},d=function(){return this.prop.showControls&&l.isIPad()},f=function(){return this.prop.mobileAutoPlay&&this.prop.mobileAutoPlayAsset&&this.client.isMobileDevice()},v=function(){this.client.registerVideo(this.element)},b=function(){if(this.prop.autoPlay){var t=this;y.call(this,!0,function(){t.prop.autoPlayDelay?setTimeout(function(){t.element.play()},t.prop.autoPlayDelay):t.element.play()})}},g=function(){e.bindEvents(this.element,[r,p,h,c],P.bind(this))},P=function(t){var i=this;t.type===r?(this.animGif&&I.call(this),this.prop.playWhenHidden||y.call(this,!1,function(){i.ignorePause=!0,t.target.pause(),i.prop.autoPlay&&y.call(i,!0,function(){t.target.play()})})):(t.type===h||t.type===p&&!this.ignorePause)&&u.call(this),this.skipBubbling?this.skipBubbling=!1:e.dispatchEvent(t.target.parentNode,t.type,null,!0),l.isIE()&&t.type===h&&!t.target.paused&&(this.skipBubbling=!0,t.target.pause()),t.type===p&&(this.ignorePause=!1)},C=function(){this.animGif&&clearTimeout(this.animGIFTimeout)},E=function(){var t=this;if(t.animGif){var i=1e3*(t.prop.mobileAutoPlayDuration>=15?15:t.prop.mobileAutoPlayDuration);e.bindEvent(t.animGif,"load",function(){S.call(t,i)})}},S=function(t){this.client.customInteraction(this.div.id+"_MobileAutoplayStart"),e.bindEvent(this.animGif,"click",k.bind(this)),e.dispatchEvent(this.div,"autoPlayStart");var i=this;this.animGIFTimeout=setTimeout(function(){e.dispatchEvent(i.div,"autoPlayEnd"),i.client.customInteraction(i.div.id+"_MobileAutoplayEnd"),I.call(i)},t)},k=function(){e.dispatchEvent(this.div,"autoPlayClick"),this.client.customInteraction(this.div.id+"_MobileAutoplayClick")},A=function(){this.animGif=o.buildImg({elementProperties:{src:this.prop.mobileAutoPlayAsset+"?"+(new Date).getTime()},styleProperties:{position:"absolute",width:"100%",height:"100%",padding:"0px",margin:"0px"}}),e.insertElementIntoContainer(this.internalContainer,this.animGif),e.applyStyle(this.element,{display:"none"}),E.call(this)},I=function(){C.call(this),e.applyStyle(this.element,{display:"block"}),e.applyStyle(this.animGif,{display:"none"}),d.call(this)&&m.call(this)};return a.prototype.type="video",a.prototype.getDefaultProperty=function(){return a.defaultProperty},a.prototype.getInputSchema=function(){return a.inputSchema},a.prototype.addProperties=function(){t.prototype.addProperties.call(this),null==this.prop.playWhenHidden&&(this.prop.playWhenHidden=!0),null==this.prop.alignment&&(this.prop.alignment="center"),null==this.prop.fitting&&(this.prop.fitting="stretch")},a.inputSchema=i.create(t.inputSchema,{poster:"asset",videoSources:"assets",mobileAutoPlay:"bool",mobileAutoPlayAsset:"asset",mobileAutoPlayDuration:"int",playWhenHidden:"bool",fitting:null,alignment:null}),a.defaultProperty="videoSources",o.fixFullScreenVideo(),s.log("video component loaded"),a});